<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>A-1APSVC • Customer</title>

  <style>
    :root { --bg:#0b1220; --card:#111b2e; --muted:#93a4c7; --text:#e7eefc; --accent:#4da3ff; --danger:#ff5a6a; }

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(135deg,#0b1220,#182a4a);
      color:var(--text);
    }

    header{
      position:sticky; top:0;
      background:rgba(11,18,32,.9);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.08);
      padding:14px 16px;
      z-index:10;
    }

    .wrap{ max-width:980px; margin:0 auto; padding:16px;}
    .top{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}

    .btn{
      background:transparent;
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      text-decoration:none;
      font-size:14px;
    }
    .btnPrimary{
      background:rgba(77,163,255,.16);
      border-color:rgba(77,163,255,.40);
    }
    .btnDanger{
      background:rgba(255,90,106,.12);
      border-color:rgba(255,90,106,.35);
    }

    .card{
      background:rgba(17,27,46,.9);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:16px;
      margin-top:16px;
    }

    .name{ font-size:22px; font-weight:900; margin:0; }
    .muted{ color:var(--muted); font-size:13px; }

    .kv{
      display:grid;
      grid-template-columns:120px 1fr;
      gap:10px 12px;
      margin-top:14px;
    }

    .actions{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }

    .field label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
    }
    .field input{
      width:100%;
      padding:10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
    }

    .formGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:14px;
    }
    .full{ grid-column:1/-1; }

    .error{
      background:rgba(255,90,106,.15);
      border:1px solid rgba(255,90,106,.4);
      padding:12px;
      border-radius:12px;
      margin-top:14px;
    }
  </style>
</head>

<body>

<header>
  <div class="wrap top">
    <h1>Customer Profile</h1>
    <div class="actions">
      <a class="btn" href="./customers.html">← Back to Customers</a>
      <a class="btn" href="./index.html">Dashboard</a>
    </div>
  </div>
</header>

<main class="wrap">
  <div id="error" class="error" style="display:none;"></div>

  <section id="view" class="card" style="display:none;">
    <h2 class="name" id="v_name"></h2>
    <p class="muted" id="v_meta"></p>

    <div class="kv">
      <div>Email</div><div id="v_email"></div>
      <div>Mobile</div><div id="v_mobile"></div>
      <div>Home</div><div id="v_home"></div>
      <div>Work</div><div id="v_work"></div>
      <div>Company</div><div id="v_company"></div>
      <div>Address</div><div id="v_address"></div>
      <div>ID</div><div id="v_id"></div>
    </div>

    <div class="actions">
      <button class="btn btnPrimary" id="btnEdit">Edit</button>
      <button class="btn btnDanger" id="btnDelete">Delete</button>
    </div>
  </section>

  <section id="edit" class="card" style="display:none;">
    <h2>Edit Customer</h2>

    <div class="formGrid">
      <div class="field"><label>First</label><input id="f_first"></div>
      <div class="field"><label>Last</label><input id="f_last"></div>
      <div class="field full"><label>Email</label><input id="f_email"></div>
      <div class="field"><label>Mobile</label><input id="f_mobile"></div>
      <div class="field"><label>Home</label><input id="f_home"></div>
      <div class="field full"><label>Work</label><input id="f_work"></div>
      <div class="field full"><label>Company</label><input id="f_company"></div>
      <div class="field full"><label>Address</label><input id="f_address"></div>
    </div>

    <div class="actions">
      <button class="btn btnPrimary" id="btnSave">Save</button>
      <button class="btn" id="btnCancel">Cancel</button>
    </div>
  </section>
</main>

<script src="./customer-data.js"></script>
<script>
  let CUSTOMER = null;

  const qs = new URLSearchParams(location.search);
  const id = qs.get("id");

  function err(msg){
    const e = document.getElementById("error");
    e.textContent = msg;
    e.style.display = "block";
  }

  function show(view){
    document.getElementById("view").style.display = view==="view"?"block":"none";
    document.getElementById("edit").style.display = view==="edit"?"block":"none";
  }

  function fillView(c){
    document.getElementById("v_name").textContent = `${c.firstName||""} ${c.lastName||""}`;
    document.getElementById("v_email").textContent = c.email||"";
    document.getElementById("v_mobile").textContent = c.mobilePhone||"";
    document.getElementById("v_home").textContent = c.homePhone||"";
    document.getElementById("v_work").textContent = c.workPhone||"";
    document.getElementById("v_company").textContent = c.company||"";
    document.getElementById("v_address").textContent = c.address||"";
    document.getElementById("v_id").textContent = c.id;
    document.getElementById("v_meta").textContent = `Updated ${c.updated_at||"—"}`;
  }

  function fillForm(c){
    f_first.value=c.firstName||"";
    f_last.value=c.lastName||"";
    f_email.value=c.email||"";
    f_mobile.value=c.mobilePhone||"";
    f_home.value=c.homePhone||"";
    f_work.value=c.workPhone||"";
    f_company.value=c.company||"";
    f_address.value=c.address||"";
  }

  async function load(){
    if(!id) return err("Missing customer id");

    const all = await initializeCustomerData();
    CUSTOMER = all.find(x=>String(x.id)===String(id));
    if(!CUSTOMER) return err("Customer not found");

    fillView(CUSTOMER);
    show("view");
  }

  btnEdit.onclick = ()=>{ fillForm(CUSTOMER); show("edit"); };
  btnCancel.onclick = ()=> show("view");

  btnSave.onclick = async ()=>{
    const updated = await updateCustomerInSupabase(CUSTOMER.id,{
      firstName:f_first.value.trim(),
      lastName:f_last.value.trim(),
      email:f_email.value.trim(),
      mobilePhone:f_mobile.value.trim(),
      homePhone:f_home.value.trim(),
      workPhone:f_work.value.trim(),
      company:f_company.value.trim(),
      address:f_address.value.trim()
    });
    CUSTOMER = updated;
    fillView(updated);
    show("view");
  };

  btnDelete.onclick = async ()=>{
    if(!confirm("Delete this customer?")) return;
    await deleteCustomerInSupabase(CUSTOMER.id);
    location.href="customers.html";
  };

  load();
</script>
</body>
</html>

