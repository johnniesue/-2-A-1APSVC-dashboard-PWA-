<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>A-1APSVC Dashboard PWA</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/style.css">

  <!-- Theme color for mobile browsers -->
  <meta name="theme-color" content="#007ACC">

  <!-- Apple touch icon -->
  <link rel="apple-touch-icon" href="/images/icon-192.png">
</head>
<body>
  <!-- Integrated header: top row (logo/status) + bottom row (tabs/search/controls) -->
  <header class="header" role="banner">
    <div class="header-content">
      <!-- top row: original logo + status -->
      <div class="header-top">
        <div class="logo-section">
          <div>
            <h1 class="company-title">A-1APSVC Dashboard</h1>
            <p class="company-subtitle">Professional Service Management</p>
          </div>
        </div>
        <div class="status-indicator">
          <div class="status-dot" aria-hidden="true"></div>
          <span>Online</span>
        </div>
      </div>

      <!-- bottom row: integrated tab bar -->
      <div class="header-bottom" role="navigation" aria-label="Primary navigation">
        <div class="hb-left">
          <nav class="tabs" role="tablist" aria-label="Main">
            <button class="tab active" role="tab" aria-selected="true" data-tab="Home">Home</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Dash">Dash</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Inbox">
              Inbox
              <span class="badge" id="inboxBadge" aria-hidden="true">1</span>
            </button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Schedule">Schedule</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Customers">Customers</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="My money">My money</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Payroll">Payroll</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Reporting">Reporting</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Marketing">Marketing</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Price book">Price book</button>
            <button class="tab" role="tab" aria-selected="false" data-tab="Pipeline">Pipeline</button>
          </nav>
        </div>

        <div class="hb-center" aria-hidden="false">
          <div class="search" role="search" aria-label="Site search">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z"
                    stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <input id="globalSearch" type="search" placeholder="Search" aria-label="Search the dashboard" />
          </div>
        </div>

        <div class="hb-right">
          <button class="btn-new" id="newBtn">New</button>

          <button class="icon-btn" title="Notifications" aria-label="Notifications" id="notifyBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2zM18 16v-5a6 6 0 1 0-12 0v5l-2 2v1h16v-1l-2-2z"
                    stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <button class="icon-btn" title="Apps" aria-label="Apps" id="appsBtn" onclick="openApps()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <rect x="3" y="3" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.3"/>
              <rect x="13" y="3" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.3"/>
              <rect x="3" y="13" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.3"/>
              <rect x="13" y="13" width="8" height="8" rx="1" stroke="currentColor" stroke-width="1.3"/>
            </svg>
          </button>

          <div class="avatar" title="You" aria-hidden="true">CC</div>
        </div>
      </div>
    </div>
  </header>

  <main class="main-container">
    <!-- (all your existing main content - unchanged) -->
    <div class="welcome-section">
      <div class="welcome-header">
        <h2 class="welcome-title">ğŸ‘‹ Hi, Chris</h2>
        <div class="date-time" id="currentDateTime" aria-live="polite"></div>
      </div>
      <p class="welcome-subtitle">Here's what's happening with your business today</p>
    </div>

    <div class="metrics-grid">
      <div class="metric-card" style="--accent-color: #3b82f6;">
        <div class="metric-header">
          <div class="metric-icon">ğŸ“‹</div>
          <div class="metric-trend trend-up">+15%</div>
        </div>
        <div class="metric-title">Open Estimates</div>
        <div class="metric-value">68</div>
        <div class="metric-subtitle">$326,998.07 total value</div>
      </div>

      <div class="metric-card" style="--accent-color: #10b981;">
        <div class="metric-header">
          <div class="metric-icon">ğŸ’°</div>
          <div class="metric-trend trend-up">+8%</div>
        </div>
        <div class="metric-title">Open Invoices</div>
        <div class="metric-value">33</div>
        <div class="metric-subtitle">$46,203.67 outstanding</div>
      </div>

      <div class="metric-card" style="--accent-color: #f59e0b;">
        <div class="metric-header">
          <div class="metric-icon">ğŸ”§</div>
          <div class="metric-trend trend-up">+12%</div>
        </div>
        <div class="metric-title">Unscheduled Jobs</div>
        <div class="metric-value">274</div>
        <div class="metric-subtitle">$265,558.37 potential</div>
      </div>

      <div class="metric-card" style="--accent-color: #8b5cf6;">
        <div class="metric-header">
          <div class="metric-icon">ğŸ“…</div>
          <div class="metric-trend trend-down">Today</div>
        </div>
        <div class="metric-title">Upcoming Visits</div>
        <div class="metric-value">0</div>
        <div class="metric-subtitle">Unscheduled service visits</div>
      </div>
    </div>

    <div class="performance-section">
      <div class="performance-header">
        <span>ğŸ“Š</span>
        <h3 class="performance-title">Today's Performance</h3>
      </div>
      <div class="performance-grid">
        <div class="performance-item">
          <div class="performance-value">$0</div>
          <div class="performance-label">Revenue Earned</div>
        </div>
        <div class="performance-item">
          <div class="performance-value">0</div>
          <div class="performance-label">Jobs Completed</div>
        </div>
        <div class="performance-item">
          <div class="performance-value">$0</div>
          <div class="performance-label">Average Job Size</div>
        </div>
        <div class="performance-item">
          <div class="performance-value">2</div>
          <div class="performance-label">Active Technicians</div>
        </div>
      </div>
    </div>

    <div class="sections-grid">
      <div class="section-card active" onclick="window.open('https://johnniesue.github.io/a1apsvc-dashboard-customers/', '_blank')">
        <div class="section-header">
          <div class="section-icon">ğŸ‘¥</div>
          <div>
            <div class="section-title">Customer Management</div>
            <div class="section-description">Manage customer data, job tracking, and service history</div>
          </div>
        </div>
        <div class="section-status status-active">âœ… Active System</div>
      </div>

      <div class="section-card" onclick="window.open('schedule.html', '_blank')">
        <div class="section-header">
          <div class="section-icon">ğŸ“…</div>
          <div>
            <div class="section-title">Scheduling</div>
            <div class="section-description">Calendar management and appointment scheduling</div>
          </div>
        </div>
        <div class="section-status status-available">âœ… Available</div>
      </div>

      <div class="section-card" onclick="window.open('reports.html', '_blank')">
        <div class="section-header">
          <div class="section-icon">ğŸ“Š</div>
          <div>
            <div class="section-title">Financial Reports</div>
            <div class="section-description">Revenue analytics and business intelligence</div>
          </div>
        </div>
        <div class="section-status status-available">âœ… Available</div>
      </div>

      <div class="section-card" onclick="showComingSoon('Service Requests')">
        <div class="section-header">
          <div class="section-icon">ğŸ”§</div>
          <div>
            <div class="section-title">Service Requests</div>
            <div class="section-description">Track and manage plumbing service requests</div>
          </div>
        </div>
        <div class="section-status status-coming-soon">â³ Coming Soon</div>
      </div>
    </div>

    <div class="quick-actions">
      <div class="quick-actions-header">
        <span>ğŸš€</span>
        <h3 class="quick-actions-title">Quick Actions for Techs</h3>
      </div>
      <div class="actions-grid">
        <a href="https://johnniesue.github.io/a1apsvc-dashboard-customers/" class="action-btn btn-primary">
          <span>ğŸ“‹</span>
          Open Customer System
        </a>
        <button class="action-btn btn-secondary" onclick="updateStatus('scheduled')">
          <span>âœ…</span>
          Mark Scheduled
        </button>
        <button class="action-btn btn-secondary" onclick="updateStatus('enroute')">
          <span>ğŸš—</span>
          I'm En Route
        </button>
        <button class="action-btn btn-tertiary" onclick="updateStatus('started')">
          <span>ğŸ”§</span>
          Job Started
        </button>
        <button class="action-btn btn-tertiary" onclick="updateStatus('complete')">
          <span>âœ…</span>
          Job Complete
        </button>
        <button class="action-btn btn-tertiary" onclick="showHelp()">
          <span>â“</span>
          Help & Support
        </button>
      </div>
    </div>

    <div class="service-area-section">
      <div class="service-area-header">
        <span>ğŸ—ºï¸</span>
        <h3 class="service-area-title">Service Area Map</h3>
      </div>
      <div id="serviceAreaMap" style="width: 100%; height: 300px; border-radius: 8px; border: 1px solid #e2e8f0; position:relative;">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d429168.10916846283!2d-96.96523!3d33.040417!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x864c19f77b45974b%3A0xb9ec9ba4f647678f!2sLucas%2C%20TX!5e0!3m2!1sen!2sus!4v1635959999999!5m2!1sen!2sus&zoom=10"
          width="100%"
          height="300"
          style="border:0; border-radius: 8px;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
        <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 0.5rem; border-radius: 4px; font-size: 0.75rem; color: #64748b;">
          ğŸ“ Service Areas: Lucas, Allen, McKinney, Plano, Frisco, Wylie, Fairview, Parker
        </div>
      </div>
    </div>

    <div class="system-status">
      <div class="status-card">
        <div class="status-icon status-connected">ğŸ”¥</div>
        <div class="status-info">
          <h4>Firebase Status</h4>
          <p>Real-time database for customer data</p>
        </div>
      </div>

      <div class="status-card">
        <div class="status-icon status-ready">ğŸ“±</div>
        <div class="status-info">
          <h4>Mobile Friendly</h4>
          <p>Optimized for field technicians on Android</p>
        </div>
      </div>

      <div class="status-card">
        <div class="status-icon status-protected">ğŸ”’</div>
        <div class="status-info">
          <h4>Data Security</h4>
          <p>Customer data is securely stored and protected</p>
        </div>
      </div>

      <div class="status-card">
        <div class="status-icon status-ready">ğŸ—ºï¸</div>
        <div class="status-info">
          <h4>Maps Integration</h4>
          <p>Google Maps with service area verification</p>
        </div>
      </div>
    </div>
  </main>

  <!-- External JavaScript (keep your existing script) -->
  <script src="/script.js"></script>

  <!-- PWA Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(registration => console.log('SW registered'))
        .catch(error => console.log('SW registration failed'));
    }
  </script>

  <!-- Integrated header/tab behavior + other utilities -->
  <script>
    (function () {
      // Tabs behavior (activation + keyboard navigation)
      const tabs = Array.from(document.querySelectorAll('.tab'));
      const tablist = document.querySelector('[role="tablist"]');

      function activateTab(targetTab, skipConsole) {
        tabs.forEach(t => {
          const isTarget = t === targetTab;
          t.classList.toggle('active', isTarget);
          t.setAttribute('aria-selected', isTarget ? 'true' : 'false');
        });
        const name = (targetTab && (targetTab.dataset.tab || targetTab.textContent.trim())) || '';
        if (!skipConsole) console.log('Activated tab:', name);
        // TODO: wire to routing or show/hide content for each section
      }

      if (tabs.length) {
        // click
        tabs.forEach(t => {
          t.addEventListener('click', () => {
            activateTab(t);
            if ((t.dataset.tab || t.textContent).trim() === 'Inbox') {
              const b = document.getElementById('inboxBadge');
              if (b) b.style.display = 'none'; // simple UX: hide badge when clicked
            }
          });
        });

        // keyboard navigation (left/right)
        tablist && tablist.addEventListener('keydown', (e) => {
          const key = e.key;
          const current = tabs.findIndex(t => t.classList.contains('active'));
          if (key === 'ArrowRight') {
            e.preventDefault();
            const next = (current + 1) % tabs.length;
            activateTab(tabs[next], true);
            tabs[next].focus();
          } else if (key === 'ArrowLeft') {
            e.preventDefault();
            const prev = (current - 1 + tabs.length) % tabs.length;
            activateTab(tabs[prev], true);
            tabs[prev].focus();
          }
        });
      }

      // New button placeholder
      document.getElementById('newBtn')?.addEventListener('click', () => {
        alert('Create a new item (wire this to your create flow).');
      });

      // Apps button placeholder
      window.openApps = function() {
        alert('Open apps menu (implement as needed).');
      };

      // Date/time updater (keeps your original behavior)
      function updateDateTime() {
        const now = new Date();
        const options = {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        };
        const el = document.getElementById('currentDateTime');
        if (el) el.textContent = now.toLocaleDateString('en-US', options);
      }
      updateDateTime();
      setInterval(updateDateTime, 60000);

      // Install prompt handling (keeps your original behavior)
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;

        // Show install banner (simple inline)
        const installBanner = document.createElement('div');
        installBanner.innerHTML = `
            <div style="position: fixed; top: 0; left: 0; right: 0; background: #007ACC; color: white; padding: 1rem; text-align: center; z-index: 1200;">
                <span>ğŸ“± Install A-1APSVC Dashboard App for quick access</span>
                <button id="installNowBtn" style="margin-left: 1rem; background: white; color: #007ACC; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Install App</button>
                <button id="installLaterBtn" style="margin-left: 0.5rem; background: transparent; color: white; border: 1px solid white; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Later</button>
            </div>
        `;
        document.body.appendChild(installBanner);
        document.getElementById('installNowBtn')?.addEventListener('click', installApp);
        document.getElementById('installLaterBtn')?.addEventListener('click', () => installBanner.remove());
      });

      function installApp() {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((result) => {
            if (result.outcome === 'accepted') {
              console.log('User accepted the install prompt');
            }
            deferredPrompt = null;
          });
        }
      }

      // Expose small utilities used elsewhere
      window.updateStatus = function(status) {
        const statusMessages = {
          'scheduled': 'Job marked as scheduled âœ…',
          'enroute': 'Status updated: En route to customer ğŸš—',
          'started': 'Job started - timer activated ğŸ”§',
          'complete': 'Job completed successfully! âœ…'
        };
        alert(statusMessages[status] || 'Status updated');
      };
      window.showHelp = function() {
        alert('Help & Support\n\nFor technical support:\nğŸ“ Call: 469-900-5194\nğŸ“§ Email: johnniesue@a-1apsvc.com\n\nFor system issues, contact your administrator.');
      };
      window.showComingSoon = function(feature) {
        alert(`${feature} feature is coming soon!\n\nThis will integrate with your existing customer management system to provide comprehensive ${feature.toLowerCase()} functionality.`);
      };

      console.log('Header with integrated tabs initialized');
    })();
  </script>
</body>
</html>
